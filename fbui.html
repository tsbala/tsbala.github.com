<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0-rc.1/jquery.mobile-1.1.0-rc.1.min.css" />
	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.1.0-rc.1/jquery.mobile-1.1.0-rc.1.min.js"></script>	
</head>
<body>
	<div data-role='header'>
		<h1>JustGiving Mobile</h1>
	</div>
	
	<div data-role='content'>
		<div id='login'>
			<div class='fb-login-button' data-show-faces='false' data-width='200' data-max-rows='1'></div>	
		</div>
		
		<div id='logout'>
		   <div id="userDetails"/>
		   <p><button  onClick='FB.logout();'>Logout</button></p>
		</div>
	</div>

	<div id='fb-root'></div>
	<script>
	  (function(d, s, id) {
		var js, fjs = d.getElementsByTagName(s)[0];
		if (d.getElementById(id)) return;
		js = d.createElement(s); js.id = id;
		js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&appId=269225433102391";
		fjs.parentNode.insertBefore(js, fjs);
	  }(document, 'script', 'facebook-jssdk'));	   

	  window.fbAsyncInit = function() {
	   FB.init({
			appId  : '269225433102391',
			status : true,
			cookie : true,
			xfbml  : true,
			oauth  : true
	   });
	   
	   FB.Event.subscribe('auth.authResponseChange', function(response) {
	      userDetails(response.authResponse);
	   });
	   
	   FB.getLoginStatus(function(response) {
	      console.log(response);
		  userDetails(response.status === 'connected');
	   });
	 }
	 
	 function userDetails(userLoggedIn) {
	      document.body.className = userLoggedIn ? 'connected' : 'not_connected';
	      if (userLoggedIn) {
			FB.api('/me', function(resp) {
			   console.log(resp);
			   $('#userDetails').append('<img src="https://graph.facebook.com/' + resp.id + '/picture">' + resp.name);
			   
			});
			getFriends();
		  }
       	  $('#login').toggle(!userLoggedIn);
		  $('#logout').toggle(userLoggedIn);
	 }
	 
	 function getFriends() {
		FB.api('/me/friends', function(resp) {
			for (int i = 0; i < resp.data.length; i++) {
				$('#userDetails').append('<div><img src="https://graph.facebook.com/' + resp.data[i].id + '/picture">' + resp.data[i].name</div>');
			}
		});
	 }
	   
	</script>
	
	<script>
		(function($) {
			$(function() {
			    $('#login').hide();
				$('#logout').hide();
			});
		})(jQuery);
	</script>
</body>
</html>
